package com.auth_service.service;

import java.time.Duration;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
@Slf4j
public class OtpService {
	
    private final RedisTemplate<String, Object> redisTemplate;

    private static final String OTP_PREFIX = "otp:";

    public void saveOtp(String email, String otp) {
    	log.info(email);
    	log.info(otp);
        if (email != null && otp != null) {
            redisTemplate.opsForValue().set(generateKey(email), otp, Duration.ofMinutes(5));
        }
    }

    public String getOtp(String email) {
        if (email == null) return null;
        Object otp = redisTemplate.opsForValue().get(generateKey(email));
        return otp != null ? otp.toString() : null;
    }

    public void deleteOtp(String email) {
        if (email != null) {
            redisTemplate.delete(generateKey(email));
        }
    }

    private String generateKey(String email) {
        return OTP_PREFIX + email.toLowerCase().trim();
    }
}
