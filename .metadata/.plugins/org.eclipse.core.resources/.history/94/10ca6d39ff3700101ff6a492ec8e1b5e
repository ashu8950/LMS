package com.user_service.mapper;

import com.user_service.dto.AuthUserDTO;
import com.user_service.dto.UserProfileDTO;
import com.user_service.dto.AddressDTO; // assuming you have this DTO
import com.user_service.entity.UserProfile;
import com.user_service.entity.Address;

public class UserProfileMapper {

    // Convert Address entity to AddressDTO
    public static AddressDTO toAddressDTO(Address address) {
        if (address == null) return null;
        return AddressDTO.builder()
                
                .street(address.getStreet())
                .city(address.getCity())
                .state(address.getState())
                .postalCode(address.getPostalCode())
                .country(address.getCountry())
                .build();
    }

    // Convert AddressDTO to Address entity
    public static Address toAddressEntity(AddressDTO dto) {
        if (dto == null) return null;
        return Address.builder()
                
                .street(dto.getStreet())
                .city(dto.getCity())
                .state(dto.getState())
                .postalCode(dto.getPostalCode())
                .country(dto.getCountry())
                .build();
    }

    public static UserProfileDTO toDTO(UserProfile profile, AuthUserDTO authUser) {
        if (profile == null) return null;
        if (authUser == null) {
            return UserProfileDTO.builder()
                    .userId(profile.getAuthUserId())
                    .email(profile.getEmail())
                    .username(profile.getUsername())
                    .role(profile.getRole())
                    .enabled(profile.getEnabled() != null ? profile.getEnabled() : true)
                    .firstName(profile.getFirstName())
                    .lastName(profile.getLastName())
                    .phoneNumber(profile.getPhoneNumber())
                    .bio(profile.getBio())
                    .profileImageUrl(profile.getProfileImageUrl())
                    .address(toAddressDTO(profile.getAddress()))  // Convert entity to DTO
                    .build();
        }
        return UserProfileDTO.builder()
                .userId(authUser.getId())
                .email(authUser.getEmail())
                .username(authUser.getUsername())
                .role(authUser.getRole())
                .enabled(authUser.getEnabled() != null ? authUser.getEnabled() : true)
                .firstName(profile.getFirstName())
                .lastName(profile.getLastName())
                .phoneNumber(profile.getPhoneNumber())
                .bio(profile.getBio())
                .profileImageUrl(profile.getProfileImageUrl())
                .address(toAddressDTO(profile.getAddress()))  // Convert entity to DTO
                .build();
    }

    // Converts DTO + AuthUserDTO to Entity (for create/update)
    public static UserProfile toEntity(UserProfileDTO dto, AuthUserDTO authUser) {
        if (dto == null || authUser == null) return null;

        return UserProfile.builder()
                .authUserId(authUser.getId())
                .email(authUser.getEmail())
                .username(authUser.getUsername())
                .role(authUser.getRole())
                .enabled(authUser.getEnabled() != null ? authUser.getEnabled() : true)
                .firstName(dto.getFirstName())
                .lastName(dto.getLastName())
                .phoneNumber(dto.getPhoneNumber())
                .bio(dto.getBio())
                .profileImageUrl(dto.getProfileImageUrl())
                .address(toAddressEntity(dto.getAddress()))  // Convert DTO to entity here
                .build();
    }

    // Update existing entity with DTO and AuthUserDTO data
    public static void updateEntity(UserProfile existing, UserProfileDTO dto, AuthUserDTO authUser) {
        if (existing == null || dto == null || authUser == null) return;

        existing.setAuthUserId(authUser.getId());
        existing.setEmail(authUser.getEmail());
        existing.setUsername(authUser.getUsername());
        existing.setRole(authUser.getRole());
        existing.setEnabled(authUser.getEnabled() != null ? authUser.getEnabled() : true);

        existing.setFirstName(dto.getFirstName());
        existing.setLastName(dto.getLastName());
        existing.setPhoneNumber(dto.getPhoneNumber());
        existing.setBio(dto.getBio());
        existing.setProfileImageUrl(dto.getProfileImageUrl());

        existing.setAddress(toAddressEntity(dto.getAddress()));  // Convert DTO to entity here
    }
}
